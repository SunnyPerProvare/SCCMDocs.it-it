---
title: "探索方法 | Microsoft Docs"
ms.custom: na
ms.date: 07/31/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ed931751-18f2-4230-a09e-a0a329fbfa1c
caps.latest.revision: "8"
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.openlocfilehash: 442e5e1fbddd00248819a8de79adc78929474fc0
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2017
---
# <a name="about-discovery-methods-for-system-center-configuration-manager"></a>System Center Configuration Manager の探索方法について

*適用対象: System Center Configuration Manager (Current Branch)*

System Center Configuration Manager の各探索方法では、ネットワーク上のさまざまなデバイス、または Active Directory のデバイスおよびユーザーを検索できます。 探索方法を効率的に使用するには、使用可能な構成および制限について理解する必要があります。  

##  <a name="bkmk_aboutForest"></a> Active Directory フォレストの探索  
 **構成可能:** ○  

 **既定で有効:** ×  

 この方法の実行に使用できる**アカウント**は次のとおりです。  

-   **Active Directory フォレスト探索アカウント** (ユーザー定義)  

-   サイト サーバーの**コンピューター アカウント**  

Active Directory のその他探索方法とは異なり、Active Directory フォレスト探索は、管理できるリソースを検出しません。 その代わりに、Active Directory で構成されているネットワークの場所を見つけて、階層全体で使用する境界に変換します。  

この方法が実行されると、ローカルの Active Directory フォレスト、信頼されている各フォレスト、および Configuration Manager コンソールの **[Active Directory フォレスト]** ノードで構成した追加の各フォレストを検索します。  

Active Directory フォレスト探索は、次の目的で使用します。  

-   Active Directory サイトおよびサブネットを探索し、そのネットワークの場所に基づいて、Configuration Manager の境界を作成する。  

-   Active Directory サイトに割り当てられているスーパー ネットを特定し、各スーパー ネットを IP アドレス範囲の境界に変換する。  

-   フォレストの Active Directory Domain Services (AD DS) に探索情報を発行する (フォレストへの発行が有効になっており、指定した Active Directory アカウントにそのフォレストのアクセス許可がある場合)。  

Configuration Manager コンソールで Active Directory フォレスト探索を管理するには、**[管理]** ワークスペースの **[階層の構成]** の下の以下のノードを使います。  

-   **探索方法**:階層の最上位で実行する Active Directory フォレストの探索を有効にすることができます。 探索を実行する簡単なスケジュールを設定したり、検出された IP サブネットと Active Directory サイトから自動的に境界が作成されるように構成することもできます。 Active Directory フォレストの探索を、子プライマリ サイトやセカンダリ サイトで実行することはできません。  

-   **Active Directory フォレスト**:探索したい Active Directory フォレストの追加、各フォレストで使用する Active Directory フォレスト アカウントの指定、見つかった情報の各フォレストへの発行の構成を行えます。 さらに、探索プロセスを監視したり、IP サブネットと Active Directory サイトを Configuration Manager の境界および境界グループのメンバーに追加したりすることもできます。  

階層の各サイトの Active Directory フォレストへの発行を構成するには、まず、Configuration Manager コンソールで、階層の最上位サイトに接続します。 Active Directory サイトの **[プロパティ]** ダイアログ ボックスの **[発行]** タブに、現在のサイトとその子サイトだけが表示されます。 フォレストへの発行が有効になっており、そのフォレストのスキーマを Configuration Manager 用に拡張している場合は、そのフォレストへの発行が有効になっている各サイトの次の情報が発行されます。  

-    **SMS-Site-&lt;サイト コード>**

-   **SMS-MP-&lt;サイト コード>-&lt;サイト システム サーバー名>**  

-   **SMS-SLP-&lt;サイト コード>-&lt;サイト システム サーバー名>**  

-   **SMS-&lt;サイト コード>-&lt;Active Directory サイト名またはサブネット>**  

> [!NOTE]  
>  セカンダリ サイトでは、Active Directory に発行するときに、必ず、セカンダリ サイト サーバーのコンピューター アカウントを使います。 セカンダリ サイトの情報を Active Directory に発行したい場合は、そのセカンダリ サイト サーバーのコンピューター アカウントに Active Directory への発行権限があることを確認してください。 信頼されていないフォレストにセカンダリ サイトからデータを発行することはできません。  

> [!CAUTION]  
>  Active Directory フォレストにサイトを発行するオプションのチェックボックスをオフにすると、そのサイトの使用可能なサイト システムの役割の情報を含め、すべての情報が Active Directory から削除されます。  

Active Directory フォレストの探索時に行われた処理は、次のログに記録されます。  

-   フォレストへの発行に関係のある処理を除くすべての処理: サイト サーバーの **&lt;InstallationPath>\Logs** フォルダーの **ADForestDisc.Log** ファイル  

-   フォレストへの発行に関係のある処理: サイト サーバーの **&lt;InstallationPath>\Logs** フォルダーの **hman.log** ファイルと **sitecomp.log** ファイル  

この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

##  <a name="bkmk_aboutGroup"></a> Active Directory グループの探索  
**構成可能:** ○  

**既定で有効:** ×  

この方法の実行に使用できる**アカウント**は次のとおりです。  

-   **Active Directory グループ探索アカウント** (ユーザー定義)  

-   サイト サーバーの**コンピューター アカウント**  

> [!TIP]  
>  このセクションの情報だけでなく、「[Active Directory グループ、システム、およびユーザー探索の一般的な機能](#bkmk_shared)」を参照してください。  

この方法は、Active Directory Domain Services を検索して以下のいずれかを特定する場合に使用します。  

-   ローカル、グローバル、およびユニバーサル セキュリティ グループ。  

-   グループのメンバーシップ。  

-   グループのメンバーのコンピューターやユーザーに関する限られた情報。この情報は、これらのコンピューターやユーザーが別の探索方法で検出されていない場合も返されます。  

この探索方法は、グループ、およびグループのメンバーの関係を識別するのが目的ですが、 既定では、セキュリティ グループだけが探索されます。 配布グループのメンバーシップも見つける場合は、**[Active Directory Group Discovery Properties (Active Directory グループ探索のプロパティ)]** ダイアログ ボックスの **[オプション]** タブで、**[配布グループのメンバーシップを探索する]** オプションのチェック ボックスをオンにする必要があります。  

Active Directory グループ探索は、Active Directory システム探索や Active Directory ユーザー探索で検出可能な Active Directory の拡張属性を返すことはできません。 この探索方法は、コンピューター リソースやユーザー リソース自体の探索用には最適化されていません。そのため、Active Directory システムの探索と Active Directory ユーザーの探索を実行した後で、この探索を実行するようにしてください。 その理由は、この探索方法ではグループについては完全な探索データ レコード (DDR) が作成されるものの、グループのメンバーであるコンピューターおよびユーザーについては限られた DDR しか作成されないためです。  

次の探索スコープを構成して、この方法で情報がどのように検索されるかを指定することができます。  

-   **場所**:1 つまたは複数の Active Directory コンテナーを検索したい場合に、このスコープを使用します。 指定した Active Directory コンテナーと、その子コンテナーを反復検索することができます。 このプロセスは、それ以上子コンテナーが見つからなくなるまで繰り返されます。  

-   [グループ****]:グループは、1 つまたは複数の特定の Active Directory グループを検索する場合に使用します。 **[Active Directory ドメイン]** オプションで、探索スコープを既定のドメインとフォレストに構成するか、個々のドメイン コントローラーに制限します。 さらに、検索するグループを 1 つまたは複数指定することができます。 グループを何も指定しなかった場合は、[Active Directory ドメイン] で指定した場所にあるすべてのグループが検索されます。 ****  

> [!CAUTION]  
>  探索スコープを構成するときは、探索する必要のあるグループだけを選択してください。 探索スコープにあるすべてのグループのすべてのメンバーが探索されるので、 グループが大きい場合は、大量の帯域幅と Active Directory のリソースが消費される可能性があります。  

> [!NOTE]  
>  Active Directory の拡張属性に基づいてコレクションを作成する (これにより、コンピューターとユーザーの正確な探索結果を得る) には、探索する内容に応じて、まず Active Directory システム探索または Active Directory ユーザー探索を実行します。  

Active Directory グループの探索時に行われた処理は、サイト サーバーの **&lt;InstallationPath\>\LOGS** フォルダーの **adsgdis.log** ファイルに記録されます。  

この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

##  <a name="bkmk_aboutSystem"></a> Active Directory システムの探索  
**構成可能:** ○  

**既定で有効:** ×  

この方法の実行に使用できる**アカウント**は次のとおりです。  

-   **Active Directory システム探索アカウント** (ユーザー定義)  

-   サイト サーバーの**コンピューター アカウント**  

> [!TIP]  
>  このセクションの情報だけでなく、「[Active Directory グループ、システム、およびユーザー探索の一般的な機能](#bkmk_shared)」を参照してください。  

この探索方法は、Active Directory Domain Services の指定された場所で、コレクションやクエリの作成に使用できるコンピューター リソースを見つけるために使います。 クライアント プッシュ インストールを使用して、検出されたデバイスに Configuration Manager クライアントをインストールすることもできます。  

既定では、この方法では、コンピューターの次の基本的な情報が探索されます。  

-   コンピューター名  

-   オペレーティング システムのバージョン  

-   Active Directory コンテナー名  

-   IP アドレス  

-   Active Directory サイト  

-   前回のログオンのタイムスタンプ  

コンピューターの DDR を正しく作成するためには、Active Directory システムの探索時に、コンピューター アカウントが識別され、そのコンピューター名が IP アドレスに解決されなければなりません。  

**[Active Directory System Discovery Properties (Active Directory システム探索のプロパティ)]** ダイアログ ボックスの **[Active Directory の属性]** タブで、Active Directory システム探索によって返された既定のオブジェクト属性をすべて一覧表示することができます。 また、追加の (拡張) 属性を探索する方法を構成することもできます。  

Active Directory システムの探索時に行われた処理は、サイト サーバーの **&lt;InstallationPath\>\LOGS** フォルダーの **adsysdis.log** ファイルに記録されます。  

この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

##  <a name="bkmk_aboutUser"></a> Active Directory ユーザー探索  
**構成可能:** ○  

**既定で有効:** ×  

この方法の実行に使用できる**アカウント**は次のとおりです。  

-   **Active Directory ユーザー探索アカウント** (ユーザー定義)  

-   サイト サーバーの**コンピューター アカウント**  

> [!TIP]  
>  このセクションの情報だけでなく、「[Active Directory グループ、システム、およびユーザー探索の一般的な機能](#bkmk_shared)」を参照してください。  

この探索方法は、Active Directory Domain Services を検索して、ユーザー アカウントとその属性を見つけるために使います。 既定では、この方法では、ユーザー アカウントの次の基本的な情報が探索されます。  

-   ユーザー名  

-   固有なユーザー名 (ドメイン名を含む)  

-   ドメイン  

-   Active Directory コンテナー名  

**[Active Directory User Discovery Properties (Active Directory ユーザー探索のプロパティ]** ダイアログ ボックスの **[Active Directory の属性]** タブで、Active Directory ユーザー探索によって返された既定のオブジェクト属性をすべて一覧表示することができます。 また、追加の (拡張) 属性を探索する方法を構成することもできます。

Active Directory ユーザーの探索時に行われた処理は、サイト サーバーの **&lt;InstallationPath\>\LOGS** フォルダーの **adusrdis.log** ファイルに記録されます。  

この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

## <a name="azureaddisc"></a> Azure Active Directory ユーザー探索
バージョン 1706 以降、Azure サービスを利用するように環境を構成するとき、Azure Active Directory (Azure AD) ユーザー探索を利用できます。
この探索方法を利用し、次の属性を見つけ、Azure AD のインスタンスに対して認証するユーザーを Azure AD で検索します。  
-   objectId
-   displayName
-   メール
-   mailNickname
-   onPremisesSecurityIdentifier
-   userPrincipalName
-   AAD tenantID

この方法は、Azure AD のユーザー データの完全同期と差分同期に対応しています。 この情報は、他の検索方法から回収した検索データと併用できます。

Azure AD ユーザー探索のアクションは、階層の最上位層サイト サーバーの SMS_AZUREAD_DISCOVERY_AGENT.log ファイルに記録されます。

Azure AD ユーザー探索を構成するには、Azure サービス ウィザードを使用します。  この探索方法を構成する方法の詳細については、「[Configure Azure AD User Discovery](/sccm/core/servers/deploy/configure/configure-discovery-methods)」 (Azure AD ユーザー探索の構成) を参照してください。





##  <a name="bkmk_aboutHeartbeat"></a> 定期探索  
**構成可能:** ○  

**既定で有効:** ○  

この方法の実行に使用できる**アカウント**は次のとおりです。  

-   サイト サーバーの**コンピューター アカウント**  

定期探索は、Configuration Manager の他の探索方法とは大きく異なります。 定期探索は、既定で有効になっており、DDR を作成するために各クライアント コンピューター (サイト サーバーではなく) で実行されます。 モバイル デバイス クライアントの場合は、この DDR は、そのモバイル デバイス クライアントが使用している管理ポイントによって作成されます。 これは、Configuration Manager クライアントのデータベースのレコードを維持するためです。定期探索を無効にしないでください。 データベースの管理に加えて、この方法では、見つかったコンピューターを新しいリソース レコードとして取り扱うことも、データベースから削除されたコンピューターのレコードを追加し直すこともできます。  

定期探索は、階層にあるすべてのクライアントを対象として構成されたスケジュールに従って実行するか、手動で呼び出して、クライアントの Configuration Manager プログラムの **[操作]** タブにある **[探索データ収集サイクル]** を実行することにより、特定のクライアントに対して実行することができます。 既定では、定期探索は 7 日おきに実行されるように設定されています。 この実行間隔を変更する場合は、必ず、"期限切れの探索データの削除" というメンテナンス タスク (サイト データベースから非アクティブなクライアント レコードを削除するタスク) の実行間隔より短くしてください。 **** "期限切れの探索データの削除" タスクは、プライマリ サイトだけで構成できます。 ****  

定期探索を実行すると、クライアントの現在の情報を含む DDR が作成されます。 その後クライアントは、この小さなファイル (約 1 KB のサイズ) をプライマリ サイトで処理できるように、管理ポイントにコピーします。 このファイルには、次の情報が含まれています。  

-   ネットワークの場所  

-   NetBIOS 名  

-   クライアント エージェントのバージョン  

-   動作状態の詳細  

クライアントのインストール ステータスの詳細を返すことができる探索方法は、定期探索だけです。 そのためには、クライアントが更新されるように、"システム リソース" 属性を **[はい]** に等しい値に設定します。  

> [!NOTE]  
>  アクティブなモバイル デバイス クライアントの DDR は、定期探索を無効にしても、作成されて送信されます。 そのため、アクティブなモバイル デバイスは、"期限切れの探索データの削除" タスクの影響を受けません。 **** これは、"期限切れの探索データの削除" タスクでデータベースのモバイル デバイスのレコードを削除すると、デバイス証明書を失効させ、モバイル デバイスからの管理ポイントへの接続もブロックすることになるためです。****  

定期探索時に行われた処理は、次のログに記録されます。  

-   コンピューター クライアントの場合: クライアントの *%Windir%\CCM\Logs* フォルダーの **InventoryAgent.log** ファイル  

-   モバイル デバイス クライアントの場合: モバイル デバイス クライアントが使用している管理ポイントの *%Program Files%\CCM\Logs* フォルダーの **DMPRP.log** ファイル  

この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

##  <a name="bkmk_aboutNetwork"></a> ネットワーク探索  
**構成可能:** ○  

**既定で有効:** ×  

この方法の実行に使用できる**アカウント**は次のとおりです。  

-   サイト サーバーの**コンピューター アカウント**  

この方法は、ネットワーク トポロジを検出したり、IP アドレスを持つネットワーク上のデバイスを検出するために使います。 ネットワーク探索は、Microsoft の実装の DHCP を実行しているサーバー、ルーターのアドレス解決プロトコル (ARP) キャッシュ、SNMP 対応デバイス、Active Directory ドメインを照会することにより、ネットワークにある IP 対応リソースを見つけます。  

ネットワーク探索を使用するには、まず探索を実行する*レベル*を指定する必要があります。 また、ネットワークのセグメントやデバイスを照会する方法も構成します。 さらに、検索時にネットワークで行われる処理を制御する設定もあります。 最後に、ネットワーク探索を実行するスケジュールを設定します。  

ネットワーク探索でリソースを見つけるには、そのリソースの IP アドレスとサブネット マスクを識別しなければなりません。 次の方法でオブジェクトのサブネット マスクを識別します。  

-   **ルーターの ARP キャッシュ:** ルーターの ARP キャッシュを照会して、サブネット情報を見つけます。 通常、ルーターの ARP キャッシュには、ごく短い時間しかデータが入っていません。 そのため、ネットワーク探索で ARP キャッシュを照会したときに、必要なオブジェクトの情報がなくなっている可能性もあります。  

-   **DHCP:** 指定された DHCP サーバーを照会して、DHCP サーバーがアドレスをリースしたデバイスを見つけます。 ネットワーク探索では、Microsoft の実装の DHCP を実行している DHCP サーバーしか照会できません。  

-   **SNMP デバイス:** SNMP デバイスを直接照会します。 ネットワーク探索時にデバイスを照会するには、そのデバイスにローカル SNMP エージェントがインストールされている必要があります。 また、SNMP エージェントで使われているコミュニティ名を、ネットワーク探索で使用するように構成する必要があります。  

ネットワーク探索時に、IP アドレスを持つことができるオブジェクトが識別され、そのサブネット マスクが判別されると、そのオブジェクトの DDR が作成されます。 通常、ネットワークには多種多様なデバイスが接続されているので、ネットワーク探索で、Configuration Manager クライアント ソフトウェアをインストールできない ( で管理できない) デバイスが見つかることがあります。 たとえば、プリンターやルーターが、このようなデバイスに当てはまります。  

ネットワーク探索では、作成される探索レコードの一部としていくつかの属性を返す場合があります。 次の設定があります。  

-   NetBIOS 名  

-   IP アドレス  

-   リソースのドメイン  

-   システムの役割  

-   SNMP コミュニティ名  

-   MAC アドレス  

ネットワーク探索時に行われた処理は、探索を実行したサイト サーバーの *&lt;InstallationPath\>\Logs* フォルダーの **Netdisc.log** ファイルに記録されます。  

 この探索方法を構成する方法の詳細については、「[Configure discovery methods for System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md)」 (System Center Configuration Manager の探索方法の構成) を参照してください。  

> [!NOTE]  
>  複雑なネットワークや帯域幅の狭い接続では、ネットワーク探索の実行に時間がかかり、大量のネットワーク トラフィックが発生する可能性があります。 ベスト プラクティスとして、検出しなければならないデバイスが、他の方法で見つからない場合だけ、ネットワーク探索を実行してください。 たとえば、ワークグループのコンピューターを見つけなければならない場合に、ネットワーク探索を実行します。 他の探索方法では、ワークグループのコンピューターが検出されません。  

###  <a name="BKMK_NetDiscLevels"></a> ネットワーク探索のレベル  
ネットワーク探索を構成するときは、次の 3 つのレベルの 1 つを指定します。  

|探索のレベル|説明|  
|------------------------|-------------|  
|トポロジ|ルーターとサブネットを探索しますが、オブジェクトのサブネット マスクは識別しません。|  
|トポロジとクライアント|トポロジに加え、クライアントになり得るオブジェクト (コンピューターなど) とリソース (プリンターやルーターなど) を探索します。 このレベルではさらに、見つかったオブジェクトのサブネット マスクも特定します。|  
|トポロジ、クライアント、およびクライアントのオペレーティング システム|トポロジ、クライアントになり得るオブジェクトに加え、コンピューターのオペレーティング システムとバージョンを探索します。 Windows ブラウザーと Windows ネットワークの呼び出しを使用します。|  

 レベルが上がるに従って、探索時に行われる処理の量と、消費されるネットワーク帯域幅が増えます。 最も高いレベルに設定する前に、発生する可能性のあるネットワーク トラフィックを考慮してください。  

 たとえば、ネットワーク探索を初めて実行するときは、トポロジ レベルに設定して、ネットワーク インフラストラクチャを確認するだけで十分かもしれません。 次に、デバイスやオペレーティング システムを確認しなければならなくなったときに、高いレベルに構成し直します。 ネットワーク探索の対象を特定の範囲のネットワーク セグメントに制限する設定を構成することもできます。 こうすることで、必要なネットワーク上のオブジェクトを検出し、不要なネットワーク トラフィックを回避すると共に、エッジ ルータやネットワーク外のオブジェクトを検出することができます。  

###  <a name="BKMK_NetDiscOptions"></a> ネットワーク探索のオプション  
ネットワーク探索で、IP アドレスを持つことができるデバイスを見つけるには、デバイスを照会する方法を決める次のオプションを指定する必要があります。  

> [!NOTE]  
>  ネットワーク探索は、探索を実行するサイト サーバーのコンピューター アカウントのコンテキストで実行されます。 コンピューター アカウントに、信頼されていないドメインに対するアクセス許可がないと、ドメインと DHCP サーバーのどちらのオプションを構成した場合も、リソースを見つけることはできません。  

**DHCP:**  

ネットワーク探索時に照会する各 DHCP サーバーを指定します。 (ネットワーク探索では、Microsoft の実装の DHCP を実行している DHCP サーバーしか照会できません。)  

-   情報を取得するために、DHCP サーバーにあるデータベースへのリモート プロシージャ コールが使われます。  

-   32 ビットと 64 ビットの両方の DHCP サーバーを照会して、各サーバーに登録されているデバイスのリストを取得できます。  

-   ネットワーク探索時に DHCP サーバーを照会するには、探索を実行するサーバーのコンピューター アカウントが、DHCP サーバーの DHCP ユーザー グループのメンバーでなければなりません。 これと同じレベルのアクセス権は、次のいずれかの条件を満たした場合に存在することになります。  

    -   指定した DHCP サーバーが、探索を実行するサーバーの DHCP サーバーである。  

    -   探索を実行するコンピューターと DHCP サーバーが同じドメインにある。  

    -   探索を実行するコンピューターと DHCP サーバーの間に双方向の信頼関係が成立している。  

    -   サイト サーバーが DHCP ユーザー グループのメンバーである。  

-   ネットワーク探索で、DHCP サーバーが列挙されるときに、常に静的な IP アドレスが検出されるとは限りません。 DHCP サーバーで割り当てから除外するように設定にされている IP アドレスの範囲に当てはまる IP アドレスはネットワーク探索で見つかりません。 手動で割り当てるために予約されている IP アドレスもネットワーク探索で見つかりません。  

**ドメイン:**  

ネットワーク探索時に検索するドメインを指定します。  

-   ネットワーク探索を実行するサイト サーバーのコンピューター アカウントは、指定した各ドメインにあるドメイン コントローラーの読み取り権限を持っている必要があります。  

-   ローカル ドメインからコンピューターを見つけるには、ネットワーク探索を実行するサイト サーバーと同じサブネットにある少なくとも 1 台のコンピューターで、コンピューター ブラウザー サービスを有効にする必要があります。  

-   ネットワークを閲覧するときにサイト サーバーから見ることができるコンピューターが検出されます。  

-   見つかったデバイスの IP アドレスを取得し、インターネット制御メッセージ プロトコルのエコー要求を使って、各デバイスを Ping します。 この **ping** コマンドを実行することにより、どのコンピューターが現在アクティブかがわかります。  

**SNMP デバイス:**  

ネットワーク探索時に照会する各 SNMP デバイスを指定します。  

-   クエリに応答した SNMP デバイスの ipNetToMediaTable 値が取得されます。 この値は、コンピューターまたは他のリソース (プリンターやルーター、IP アドレスを持つことができる他のデバイス) の IP アドレスの配列です。  

-   デバイスを照会するには、そのデバイスの IP アドレスか NetBIOS 名を指定する必要があります。  

-   ネットワーク探索でデバイスのコミュニティ名を使用するように構成してください。このように構成しないと、SNMP クエリがデバイスによって拒否されます。  

###  <a name="BKMK_LimitNetDisc"></a> ネットワーク探索を制限する  
ネットワーク探索時に、ネットワークの端にある SNMP デバイスを照会する場合は、ネットワークのすぐ外にあるサブネットと SNMP デバイスの情報を識別することができます。 次の情報を使用してネットワーク探索の範囲を制限するには、ネットワーク探索時に通信する SNMP デバイスと、照会するネットワーク セグメントを構成します。  

**サブネット:**  

ネットワーク探索で [SNMP デバイス] オプションか [DHCP] オプションを使用するときに、照会するサブネットを構成します。 この 2 つのオプションで検索されるのは、有効にしたサブネットだけです。  

たとえば、DHCP サーバーの照会によって、ネットワーク全体のデバイスの情報が返されますが、 特定のサブネットにあるデバイスだけを見つけたい場合は、**[ネットワーク探索のプロパティ]** ダイアログ ボックスの **[サブネット]** タブで、その特定のサブネットを指定して有効にします。 このように設定すると、今後実行される、DHCP サーバーを使用した探索と SNMP 検出タスクの範囲が、指定したサブネットに制限されます。  

> [!NOTE]  
>  ただし、このサブネットの構成は、**[ドメイン]** オプションを設定した探索で検索されるオブジェクトを制限しません。  

**SNMP コミュニティ名:**  

ネットワーク探索で SNMP デバイスを照会するには、ネットワーク探索を構成するときに、そのデバイスのコミュニティ名を指定する必要があります。 SNMP デバイスのコミュニティ名を使用しないと、デバイスによってクエリが拒否されます。  

**最大ホップ数:**  

ネットワーク探索で SNMP を使って照会できるネットワーク セグメントの数とルーターの数を制限します。  

ここで指定するホップの数によって、ネットワーク探索時に照会できる追加のデバイスの数とネットワーク セグメントのが決まります。  

たとえば、探索のレベルをトポロジに設定し、[最大ホップ数] を **0** に設定した場合は、照会元のサーバーが存在するサブネットが探索されます。 そのサブネットにルーターがあれば、それが含まれます。  

次の図は、探索のレベルをトポロジのみに設定し、[最大ホップ数] を 0 に指定したネットワーク探索クエリをサーバー 1 で実行する例を示しています。この場合、サブネット D とルーター 1 が見つかります。  

 ![ルーター ジャンプのない探索のイメージ](media/Disc-0.gif)  

 次の図は、探索のレベルを [トポロジとクライアント] に設定し、[最大ホップ数] を 0 に指定したネットワーク探索クエリをサーバー 1 で実行する例を示しています。この場合、サブネット D とルーター 1、およびサブネット D にある、クライアントになり得るデバイスすべてが見つかります。  

 ![1 つのルーター ジャンプを含む探索のイメージ](media/Disc-1.gif)  

 ルーターのホップ数を大きくすると、検出されるネットワーク リソースの数が増える可能性があることを、次のネットワークを例にして説明します。  

 ![2 つのルーター ジャンプを含む探索のイメージ](media/Disc-2.gif)  

 探索のレベルをトポロジに、[最大ホップ数] を 1 に設定したネットワーク探索をサーバー 1 で実行すると、次のものが検出されます。  

-   ルーター 1 とサブネット 10.1.10.0 (最大ホップ数を 0 にした場合も検出されます)  

-   サブネット 10.1.20.0 と 10.1.30.0、サブネット A、ルーター 2 (1 番目のホップにあります)  

> [!WARNING]  
>  ルーターのホップ数を上げるに従って、検出可能なリソースの数が大幅に増える可能性があります。ただし、消費されるネットワーク帯域幅も大きくなります。  

##  <a name="bkmk_aboutServer"></a> サーバー探索  
**構成可能:** ×  

Configuration Manager では、ユーザーが構成できる探索方法だけでなく、**サーバー探索**というプロセス (SMS_WINNT_SERVER_DISCOVERY_AGENT) も使います。 このプロセスでは、サイト システムのコンピューター (管理ポイントとして構成されているコンピューターなど) のリソースのレコードが作成されます。  

##  <a name="bkmk_shared"></a> Active Directory グループの探索、Active Directory システムの探索、Active Directory ユーザーの探索に共通の機能  
ここでは、次の探索方法に共通する機能ついて説明します。  

-   Active Directory グループの探索  

-   Active Directory システムの探索  

-   Active Directory ユーザー検出  

> [!NOTE]  
>  このセクションの情報は、Active Directory フォレストの探索には当てはまりません。  

この 3 つの探索方法には、同様の構成と操作が使用されます。 それぞれ Active Directory Domain Services に格納されたコンピューター、ユーザー、リソースのグループ メンバーシップに関する情報を探索します。 探索プロセスは、探索を実行するように構成された各サイトのサイト サーバーで実行されている探索エージェントによって管理されます。 どの方法でも、Active Directory の検索する 1 つまたは複数の場所をローカルまたはリモート フォレスト内の場所インスタンスとして構成することができます。  

信頼されていないフォレストでリソースの検索する場合は、次のことが必要です。  

-   Active Directory システムの探索でコンピューター リソースを探索する場合は、探索エージェントが、そのリソースの FQDN を解決できなければなりません。 FQDN を解決できない場合は、NetBIOS 名を解決します。  

-   Active Directory ユーザー探索でユーザーを、または Active Directory グループ探索でグループを探索する場合は、探索エージェントが、Active Directory の場所として指定されたドメイン コントローラーの FQDN を解決できなければなりません。  

指定する場所ごとに、検索オプションを構成することができます。たとえば、Active Directory の子コンテナーの場所を繰り返し検索するオプションがあります。 また、この場所を検索するときに使用する固有なアカウントを構成することもできます。 そのため、複数のフォレスト内の複数の Active Directory の場所を探索する方法を 1 つのサイトで構成できます。すべての場所のアクセス許可を持っている単一のアカウントを構成する必要はありません。  

この 3 つの探索方法のいずれかを特定のサイトで実行すると、そのサイトの Configuration Manager サイト サーバーが、指定された Active Directory フォレスト内の最も近いドメイン コントローラーと通信して、Active Directory のリソースを見つけます。 ドメインとフォレストは、Active Directory のサポートされているどのモードでもかまいません。 それぞれの場所インスタンスに割り当てるアカウントには、指定した Active Directory の場所の**読み取り**アクセス許可が必要です。

まず、指定された場所でオブジェクトが検索され、そのオブジェクトに関する情報が収集されます。 リソースに関する十分な情報が収集されると、DDR が作成されます。 必要な情報は、使用している探索方法によって異なります。  

異なる Configuration Manager サイトでローカルの Active Directory サーバーを照会する同じ探索方法を構成する場合は、サイトごとに別々の探索オプションを構成することができます。 探索データは、階層にあるサイトで共有されるので、構成が重なり合うのを避け、各リソースが一度だけ検出されるようにしてください。

環境の規模が小さい場合は、それぞれの探索方法を階層内の 1 つのサイトだけで実行して、管理上のオーバーヘッドを抑えると共に、同じリソースが何度も検出される危険性を下げてください。 探索を実行するサイトの数を最小に抑えるとき、検索で使用される全体的ネットワーク帯域幅を減らすことができます。 作成後、サイト サーバーで処理する必要がある DDR の全体的数も減らすことができます。  

探索方法の構成の多くは、一目見ただけで、その意味がわかります。 次のセクションでは、探索オプションを実際に構成する前に知っておく必要のある情報を説明します。  

次の表に、Active Directory の複数の探索方法で使用できるオプションを示します。  

-   [差分探索](#bkmk_delta)  

-   [古いコンピューター レコードをドメインへのログオン日時に基づいて除外する](#bkmk_stalelogon)  

-   [古いレコードをコンピューターのパスワードに基づいて除外する](#bkmk_stalepassword)  

-   [Active Directory のカスタマイズされた属性を検索する](#bkmk_customAD)  

###  <a name="bkmk_delta"></a> 差分探索  
次の探索方法に使用できます。  

-   Active Directory グループの探索  

-   Active Directory システムの探索  

-   Active Directory ユーザー検出  

差分探索は独立した探索方法ではなく、該当する探索方法で選択できるオプションです。 差分探索では、該当する探索方法で完全な探索が最後に実行されてから行われた変更について、特定の Active Directory 属性を検索します。 属性の変更が Configuration Manager データベースに送信されて、リソースの探索レコードが更新されます。  

既定では、差分探索は 5 分間隔で実行されます。 これは、完全な探索の通常のスケジュールよりもかなり高い頻度です。  差分探索では、使用するサイト サーバーおよびネットワーク リソースが完全な探索よりも少ないので、このような頻繁な実行が可能になります。 探索方法で差分探索を使用する場合は、その完全な探索を実行する頻度を下げることができます。  

次に、差分探索を使ってよく検出する変更点をいくつか示します。  

-   Active Directory に追加された新しいコンピューターとユーザー  

-   コンピューターとユーザーの基本的な情報の変更  

-   グループに追加された新しいコンピューターとユーザー  

-   グループから削除されたコンピューターとユーザー  

-   システム グループ オブジェクトに加えられた変更  

差分探索で、新しいリソースとグループのメンバーシップの変更を検出できますが、Active Directory からどの時点でリソースが削除されたかを検出することはできません。 差分探索で生成される DDR は、完全な探索で生成される DDR と同様に処理されます。  

差分検索を構成するには、該当する探索方法のプロパティの [ポーリングのスケジュール] タブを使います。 ****  

###  <a name="bkmk_stalelogon"></a> 古いコンピューター レコードをドメインへのログオン日時に基づいて除外する  
次の探索方法に使用できます。  

-   Active Directory グループの探索  

-   Active Directory システムの探索  

コンピューターでのドメインへの最後のログオン日時に基づいて、古いコンピューター レコードを持つコンピューターを探索から除外できます。 Active Directory システムの探索でこのオプションを有効にすると、見つかった各コンピューターが評価されます。 Active Directory グループの探索でこのオプションを有効にすると、見つかったグループに属する各コンピューターが評価されます。  

このオプションを使用するには、次のことが必要です。  

-   コンピューターが Active Directory Domain Services の **lastLogonTimeStamp** 属性を更新するように構成されている。  

-   Active Directory ドメインの機能レベルが Windows Server 2003 以降に設定されている。  

この設定に使用する、探索の基準にする最後のログイン日時を構成するときは、ドメイン コントローラー同士のレプリケーション間隔を考慮してください。  

フィルタリングは、**[Active Directory System Discovery Properties (Active Directory システム探索のプロパティ)]** ダイアログ ボックスと **[Active Directory Group Discovery Properties (Active Directory グループの探索のプロパティ)]** ダイアログ ボックスの **[オプション]** タブで構成します。 **[指定した期間内にドメインにログオンしたコンピューターのみ探索する]** オプションを選択します。  

> [!WARNING]  
>  このフィルターと、**古いレコードをコンピューターのパスワードに基づいて除外する**フィルターを有効にした場合は、どちらかのフィルターの基準を満たしたコンピューターが探索から除外されます。  

###  <a name="bkmk_stalepassword"></a> 古いレコードをコンピューターのパスワードに基づいて除外する  
次の探索方法に使用できます。  

-   Active Directory グループの探索  

-   Active Directory システムの探索  

コンピューターで最後に更新されたコンピューター アカウントのパスワードに基づいて、古いコンピューター レコードを含むコンピューターを探索から除外します。 Active Directory システムの探索でこのオプションを有効にすると、見つかった各コンピューターが評価されます。 Active Directory グループの探索でこのオプションを有効にすると、見つかったグループに属する各コンピューターが評価されます。  

このオプションを使用するには、次のことが必要です。  

-   コンピューターが Active Directory Domain Services の **pwdLastSet** 属性を更新するように構成されている。  

このオプションを構成するときは、この属性の更新間隔と、ドメイン コントローラー同士のレプリケーション間隔の両方を考慮してください。  

フィルタリングは、**[Active Directory System Discovery Properties (Active Directory システム探索のプロパティ)]** ダイアログ ボックスと **[Active Directory Group Discovery Properties (Active Directory グループの探索のプロパティ)]** ダイアログ ボックスの **[オプション]** タブで構成します。 **[指定した期間内にアカウントのパスワードが更新されたコンピューターのみ探索する]** オプションを選択します。  

> [!WARNING]  
>  このフィルターと、**古いレコードをドメインへのログイン日時に基づいて除外する**フィルターを有効にした場合は、どちらかのフィルターの基準を満たしたコンピューターが探索から除外されます。  

###  <a name="bkmk_customAD"></a> Active Directory のカスタマイズされた属性を検索する  
 次の探索方法に使用できます。  

-   Active Directory システムの探索  

-   Active Directory ユーザー検出  

探索方法ごとに、検出可能な Active Directory 属性の一覧が用意されています。  

カスタマイズされた属性の一覧を表示および構成するには、**[Active Directory System Discovery Properties (Active Directory システム探索のプロパティ)]** ダイアログ ボックス、または **[Active Directory User Discovery Properties (Active Directory ユーザー探索のプロパティ)]** ダイアログボックスの **[Active Directory の属性]** タブを使います。  
