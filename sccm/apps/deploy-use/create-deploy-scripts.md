---
title: "Configuration Manager でのスクリプトの作成と実行 | Microsoft Docs"
description: "Configuration Manager を使用して、クライアント デバイスでスクリプトを作成し、実行します。"
ms.custom: na
ms.date: 08/09/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-app
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: cc230ff4-7056-4339-a0a6-6a44cdbb2857
caps.latest.revision: "14"
caps.handback.revision: "0"
author: robstackmsft
ms.author: robstack
manager: angrobe
ms.openlocfilehash: ed84f7900eee5c04728d0e4d1b46027c36327bec
ms.sourcegitcommit: b41d3e5c7f0c87f9af29e02de3e6cc9301eeafc4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/11/2017
---
# <a name="create-and-run-powershell-scripts-from-the-configuration-manager-console"></a>Configuration Manager コンソールから PowerShell スクリプトを作成して実行する

*適用対象: System Center Configuration Manager (Current Branch)*

Configuration Manager では、パッケージとプログラムを使用してスクリプトを展開できるだけでなく、次のようなアクションを実行できる機能があります。

- PowerShell スクリプトを Configuration Manager にインポートする
- Configuration Manager コンソールからスクリプトを編集する (署名されていないスクリプトのみ)
- セキュリティを強化するため、スクリプトを承認または拒否としてマークする
- Windows クライアント コンピューターのコレクションおよびオンプレミスの管理対象 Windows PC でスクリプトを実行する。 スクリプトは展開されず、クライアント デバイスでほぼ即時に実行されます。
- Configuration Manager コンソールで、スクリプトによって返される結果を確認する

>[!TIP]
>このバージョンの Configuration Manager では、スクリプトはプレリリース機能です。 スクリプトを有効にする方法については、「[System Center Configuration Manager のプレリリース機能](/sccm/core/servers/manage/pre-release-features)」を参照してください。

## <a name="prerequisites"></a>必要条件

PowerShell スクリプトを実行するには、クライアントで PowerShell バージョン 3.0 以降を実行している必要があります。 ただし、実行するスクリプトに、より新しいバージョンの PowerShell の機能が含まれている場合、スクリプトを実行するクライアントがそのバージョンを実行している必要があります。

Configuration Manager クライアントがスクリプトを実行するには、1706 リリース以降のクライアントを実行している必要があります。

スクリプトを使用するには、適切な Configuration Manager のセキュリティ ロールのメンバーである必要があります。

- スクリプトをインポートおよび作成するには: **コンプライアンス設定マネージャー**のセキュリティ ロールで、**SMS スクリプト**への**作成**アクセス許可がアカウントに付与されている必要があります。
- スクリプトを承認または拒否するには: **コンプライアンス設定マネージャー**のセキュリティ ロールで、**SMS スクリプト**への**承認**アクセス許可がアカウントに付与されている必要があります。
- スクリプトを実行するには: **コンプライアンス設定マネージャー**のセキュリティ ロールで、**コレクション**への**スクリプトの実行**アクセス許可がアカウントに付与されている必要があります。

Configuration Manager のセキュリティ ロールの詳細については、「[ロール ベース管理の基礎](/sccm/core/understand/fundamentals-of-role-based-administration)」を参照してください。

既定では、ユーザーは自分が作成したスクリプトを承認できません。 スクリプトは強力で用途が広く、多くのデバイスに展開できるため、スクリプトを作成する人と、そのスクリプトを承認する人とでロールを分けることができます。 ロールを分けることで、監視なしのスクリプト実行に対してセキュリティ レベルがさらに高くなります。 テストの場合は、便宜的にこの 2 つ目の承認を無効にすることもできます。

## <a name="allow-users-to-approve-their-own-scripts"></a>ユーザーが自身のスクリプトを承認できるようにする

1. Configuration Manager コンソールで、[ **管理**] をクリックします。
2. [ **管理** ] ワークスペースで [ **サイトの構成**] を展開して、[ **サイト**] をクリックします。
3. サイトの一覧で、自分のサイトを選択し、**[ホーム]** タブの **[サイト]** グループで **[階層設定]** をクリックします。
4. **[階層設定のプロパティ]** ダイアログ ボックスの **[全般]** タブで、**[Do not allow script authors to approve their own scripts]\(スクリプト作成者に自身のスクリプトの承認を許可しない\)** チェック ボックスをオフにします。

## <a name="import-and-edit-a-script"></a>スクリプトをインポートして編集する

1. Configuration Manager コンソールで、**[ソフトウェア ライブラリ]** をクリックします。
2. **[ソフトウェア ライブラリ]** ワークスペースで **[スクリプト]** をクリックします。
3. **[ホーム]** タブの **[作成]** グループで、**[スクリプトの作成]** をクリックします。
4. **スクリプトの作成**ウィザードの **[スクリプト]** ページで、次の設定を構成します。
    - **[スクリプト名]**: スクリプトの名前を入力します。 同じ名前の複数のスクリプトを作成できますが、重複する名前を使用すると、Configuration Manager コンソールで必要なスクリプトを見つけるのがより困難になります。
    - **[スクリプト言語]**: 現時点では、PowerShell スクリプトのみがサポートされています。
    - **[インポート]**: PowerShell スクリプトをコンソールにインポートします。 スクリプトは **[スクリプト]** フィールドに表示されます。
    - **[クリア]**: [スクリプト] フィールドから現在のスクリプトを削除します。
    - **[スクリプト]**: 現在インポートされたスクリプトが表示されます。 必要に応じて、このフィールドでスクリプトを編集できます。
5. ウィザードを完了します。 新しいスクリプトが**[承認を待っています]**の状態で **[スクリプト]** リストに表示されます。 このスクリプトをクライアント デバイスで実行するには、先にそのスクリプトを承認する必要があります。

### <a name="script-examples"></a>スクリプトの例

この機能で利用する可能性があるスクリプトの例をいくつか紹介します。

#### <a name="create-a-folder"></a>フォルダーを作成します

*New-Item "c:\scripts" -type folder name* 
 
 
#### <a name="create-a-file"></a>ファイルを作成する

*New-Item c:\scripts\new_file.txt -type file name*


## <a name="approve-or-deny-a-script"></a>スクリプトの承認または拒否

スクリプトを実行する前に、そのスクリプトが承認されている必要があります。 スクリプトを承認するには、次の手順を実行します。

1. Configuration Manager コンソールで、[ソフトウェア ライブラリ] ****をクリックします。
2. **[ソフトウェア ライブラリ]** ワークスペースで **[スクリプト]** をクリックします。
3. **[スクリプト]** リストで、承認または拒否するスクリプトを選択し、**[ホーム]** タブの **[スクリプト]** グループで、**[承認]/[拒否]** をクリックします。
4. **[スクリプトの承認/拒否]** ダイアログ ボックスで、スクリプトの **[承認]** または **[拒否]** を選択し、必要に応じて決定に関するコメントを入力します。 スクリプトを拒否すると、クライアント デバイスでそのスクリプトを実行できません。
5. ウィザードを完了します。 **[スクリプト]** リストの **[承認状態]** 列は、行った操作に応じて変わります。

## <a name="run-a-script"></a>[スクリプトの実行]
スクリプトが承認されたら、選択したコレクションに対してそのスクリプトを実行できます。

1. Configuration Manager コンソールで、 **[資産とコンプライアンス]**をクリックします。
2. [資産とコンプライアンス] ワークスペースで **[デバイス コレクション]** をクリックします。
3. **[デバイス コレクション]** リストで、スクリプトを実行するデバイスのコレクションをクリックします。
4. **[ホーム]** タブの **[すべてのシステム]** グループで、**[スクリプトの実行]**をクリックします。
5. **スクリプトの実行**ウィザードの **[スクリプト]** ページで、リストからスクリプトを選択します。 承認済みスクリプトのみが表示されます。
6. **[次へ]** をクリックして、ウィザードを完了します。

>[!IMPORTANT]
>スクリプトには、1 時間の実行期間が与えられます。 この期間内にスクリプトが実行されない場合 (PC の電源が切れている場合など)、この手順をもう一度実行する必要があります。

## <a name="next-steps"></a>次のステップ

クライアント デバイスにスクリプトを実行したら、次の手順を使用して操作の成功を監視します。

1. Configuration Manager コンソールで、[ **監視**] をクリックします。
2. **[監視]** ワークスペースで、**[スクリプトのステータス]** をクリックします。
3. **[スクリプトのステータス]** リストには、クライアント デバイスで実行した各スクリプトの結果が表示されます。 スクリプトの終了コード **0** は、通常、スクリプトが正常に実行されたことを示します。
